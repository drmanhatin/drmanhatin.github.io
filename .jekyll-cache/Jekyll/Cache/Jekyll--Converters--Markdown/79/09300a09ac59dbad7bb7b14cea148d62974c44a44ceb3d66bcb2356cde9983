I"«<h1 id="azure-customvision-realtime-recognition-demo">Azure CustomVision Realtime Recognition demo</h1>

<p>For a customer I was tasked to demonstrate the capabilities of <a href="https://customvision.ai">Azureâ€™s CustomVision platform</a>. To help truly envision what the CustomVision platform can do, I proposed we should try to make the demonstration happen in â€˜real timeâ€™. Real time in this case means drawing the labels over the recognized objects within the timespan of seconds. In this blog post, I will demonstrate how simple it is to teach a CustomVision model to recognize different chess pieces.</p>

<p>If you follow this tutorial from front to back, you can expect to have a working model within a few hours.</p>

<h3 id="this-is-the-end-result">This is the end result</h3>
<div style="max-width: 100%">
<iframe width="560" height="560" style="max-width: 100%" src="https://www.youtube.com/embed/t0P6LBDkSlc" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</div>

<p>As you can see in the video above, which I took using my phone, the CustomVision model can recognize most chess pieces easily. It does have some trouble with recognizing the differences between a pawn and a rook, which is understandable. These pieces are pretty similar, and Iâ€™ve only fed the model about 100 photoâ€™s yet.</p>

<p>On a technical level, what happens in this video is this:</p>

<ol>
  <li>The phone takes a picture, using my <a href="https://github.com/drmanhatin/CustomVisionRealTime">CustomVision RealTime toolkit</a>. This toolkit is run in the browser, <strong>so no app required!</strong></li>
  <li>The picture is compressed on the phone, to save bandwidth, speed up the upload, and to ensure that the video does not exceed 4MB (max size for labeling in CustomVision)</li>
  <li>The picture is sent to the CustomVision API</li>
  <li>CustomVision returns the labels and the coordinates of where it has detected these labels</li>
  <li>The labels are drawn over the camera screen in the browser</li>
</ol>

<p>This process typically takes between 1 to 2 seconds per picture, depending on the network speed, device speed and the size of the picture.</p>

<h3 id="how-to-teach-customvision-to-recognize-different-chess-pieces">How to teach CustomVision to recognize different chess pieces</h3>

<p>This is actually VERY simple and doesnâ€™t require ANY knowledge of programming or machine learning. First, create an account on Azure CustomVision if you donâ€™t have one yet. Then, create a project, select â€œObject Detectionâ€ and â€œGeneralâ€ domain.</p>

<p>Next step is to take pictures of your chess pieces. In order to be as efficient as possible, take pictures keeping the following things in mind:</p>

<ul>
  <li>Take photos from many different angles</li>
  <li>Take photos in consistent lighting (e.g. if you need to recognize the chess pieces in daytime light, feed the CustomVision model images of chess pieces in daytime light)</li>
  <li>Label photos accurately, draw the bounding boxes as close to the pieces as possible</li>
</ul>

<p>then you can label multiple chess pieces at the same time and at different angles. As such:
<img src="/assets/images/chess-1.png" alt="chess pieces labeled" /></p>

<p>A minimum of 15 images per â€œtagâ€ (type of object, in this case a rook, bishop, pawn, queen, king or knight) is required. Typically, more images will lead to a better result. After taking the pictures, itâ€™s time to upload them to CustomVision. Go to the â€œTraining Imagesâ€ tab and click â€œAdd Imagesâ€. Upload all your images. Now for each image, tag the images with the right labels.  <img src="/assets/images/pawn.png" alt="chess piece pawn" /></p>

<p>Once you have labeled all your pictures, click â€œtrainâ€ in the top right corner of the CustomVision portal and select â€œQuick Trainingâ€. After a few minutes, the training will finish. In the â€œPerformanceâ€ tab of the portal, you can see how the model has performed. If you want to test the model â€œin realtimeâ€, click â€œPublishâ€. Then, click on the â€œPrediction URLâ€ button. Here you can find the URL + key, which you will require in the next step.</p>

<p>In the â€œPerformanceâ€ tab I have selected a probability threshold of 70%, this means that if the label is less than 70% certain, it wonâ€™t count as a good result. I have also selected an overlap threshold of 50%, which means that the detected label bounding box should overlap at least 50% with the bounding box you have created in the portal, else it will not count as a good result either. The result (after about 160 images and 24 hours of training):
<img src="/assets/images/prediction.png" alt="prediction stats" /></p>

<p>If you have obtained your key and url, go to the <a href="https://customvision.victorsanner.nl">CustomVision Toolbox</a> on your phone. Now enter the URL + Key. Point your phone at a few chess pieces and see how your model performs!</p>

:ET